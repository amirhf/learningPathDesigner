# Learning Path Designer - Implementation Plan & Commands
**Date:** 2025-11-09 00:35 (Session)  
**Status:** 98% Complete - Ready for Data Seeding & Deployment

---

## üìä Current Implementation Status

### ‚úÖ Completed (98%)

| Component | Status | Completion |
|-----------|--------|------------|
| **Infrastructure** | ‚úÖ Complete | 100% |
| **Database Schema** | ‚úÖ Complete | 100% |
| **Gateway Service** | ‚úÖ Complete | 100% |
| **RAG Service** | ‚úÖ Complete + Optimized | 100% |
| **Planner Service** | ‚úÖ Complete | 100% |
| **Quiz Service** | ‚úÖ Complete | 100% |
| **Frontend** | ‚úÖ Complete | 100% |
| **Performance Optimization** | ‚úÖ Complete | 100% |
| **Documentation** | ‚úÖ Excellent | 100% |
| **Data Seeding** | ‚ö†Ô∏è Partial | 30% |
| **Testing** | ‚ö†Ô∏è Manual Only | 40% |
| **Deployment** | ‚ö†Ô∏è Not Started | 0% |

---

## üéØ Next Steps (Priority Order)

### 1. Data Seeding (HIGH PRIORITY)
- [ ] Seed skills database with comprehensive skill graph
- [ ] Ingest learning resources (start with 100-500 quality resources)
- [ ] Extract and upload resource content snippets to S3
- [ ] Verify Qdrant collection and embeddings

### 2. Authentication & Security (HIGH PRIORITY)
- [ ] Configure Supabase Auth
- [ ] Add JWT validation to services
- [ ] Implement rate limiting in gateway
- [ ] Restrict CORS to frontend domain
- [ ] Secure API keys in production

### 3. Testing (MEDIUM PRIORITY)
- [ ] Write unit tests for services
- [ ] Integration tests for API flows
- [ ] E2E tests with Playwright
- [ ] Load testing

### 4. Deployment (MEDIUM PRIORITY)
- [ ] Deploy backend to Railway
- [ ] Deploy frontend to Vercel
- [ ] Configure production database (Neon/Supabase)
- [ ] Set up Qdrant Cloud
- [ ] Configure S3 bucket

### 5. Enhancements (LOW PRIORITY)
- [ ] Implement content-based RAG (use actual resource content)
- [ ] Utilize prerequisite graph in planning
- [ ] Add user feedback loop
- [ ] Resource quality scoring

---

## üöÄ Quick Start Commands

### Initial Setup

```powershell
# Clone repository (if needed)
git clone <repo-url>
cd learnPathDesigner

# Copy environment file
cp .env.example .env.local

# Edit .env.local with your API keys
# Required: OPENROUTER_API_KEY
notepad .env.local

# Create virtual environment
python -m venv .venv

# Activate virtual environment (Windows)
.\.venv\Scripts\Activate.ps1

# Install Python dependencies
pip install -r ingestion/requirements.txt
pip install -r services/rag/requirements.txt
pip install -r services/planner/requirements.txt
pip install -r services/quiz/requirements.txt
```

---

## üê≥ Docker Commands

### Start Infrastructure

```powershell
# Start all infrastructure services
docker-compose up -d postgres qdrant redis

# Check status
docker-compose ps

# View logs
docker-compose logs -f

# Stop all services
docker-compose down

# Stop and remove volumes (WARNING: deletes data)
docker-compose down -v
```

### Start All Services (Docker)

```powershell
# Start everything
docker-compose up -d

# View logs for specific service
docker-compose logs -f rag-service
docker-compose logs -f planner-service
docker-compose logs -f quiz-service
docker-compose logs -f gateway

# Restart specific service
docker-compose restart rag-service

# Rebuild and restart service
docker-compose up -d --build rag-service
```

---

## üóÑÔ∏è Database Commands

### Run Migrations

```powershell
# Method 1: Via Docker (recommended)
Get-Content shared/migrations/001_initial_schema.sql | docker exec -i learnpath-postgres psql -U postgres -d learnpath
Get-Content shared/migrations/002_service_tables.sql | docker exec -i learnpath-postgres psql -U postgres -d learnpath

# Method 2: Using PowerShell script (requires psql installed)
.\ops\migrate.ps1

# Method 3: Manual (if psql installed locally)
psql -U postgres -d learnpath -f shared/migrations/001_initial_schema.sql
psql -U postgres -d learnpath -f shared/migrations/002_service_tables.sql
```

### Database Management

```powershell
# Connect to database
docker exec -it learnpath-postgres psql -U postgres -d learnpath

# List tables
docker exec -it learnpath-postgres psql -U postgres -d learnpath -c "\dt"

# Check table schema
docker exec -it learnpath-postgres psql -U postgres -d learnpath -c "\d resources"

# Count resources
docker exec -it learnpath-postgres psql -U postgres -d learnpath -c "SELECT COUNT(*) FROM resources;"

# View recent plans
docker exec -it learnpath-postgres psql -U postgres -d learnpath -c "SELECT plan_id, goal, created_at FROM learning_plans ORDER BY created_at DESC LIMIT 5;"

# Backup database
docker exec learnpath-postgres pg_dump -U postgres learnpath > backup_$(Get-Date -Format 'yyyy-MM-dd').sql

# Restore database
Get-Content backup_2025-11-09.sql | docker exec -i learnpath-postgres psql -U postgres -d learnpath
```

---

## üì• Data Seeding Commands

### Seed Skills

```powershell
# Activate virtual environment first
.\.venv\Scripts\Activate.ps1

# Seed skills from JSON file
python -m ingestion.seed_skills

# Verify skills were created
docker exec -it learnpath-postgres psql -U postgres -d learnpath -c "SELECT COUNT(*) FROM skill;"
```

### Setup Qdrant Collection

```powershell
# Create Qdrant collection for resources
python -m ingestion.setup_qdrant

# Verify collection exists
curl http://localhost:6333/collections/resources
```

### Ingest Resources

```powershell
# Ingest all resources from seed file
python -m ingestion.ingest --seed ingestion/seed_resources.json

# Ingest limited number (for testing)
python -m ingestion.ingest --seed ingestion/seed_resources.json --limit 50

# Verify resources were ingested
docker exec -it learnpath-postgres psql -U postgres -d learnpath -c "SELECT COUNT(*) FROM resource;"

# Check Qdrant collection size
curl http://localhost:6333/collections/resources
```

---

## üîß Local Development Commands

### Start Services Locally (Without Docker)

**Terminal 1 - RAG Service:**
```powershell
.\.venv\Scripts\Activate.ps1
cd services/rag
uvicorn main:app --reload --port 8001
```

**Terminal 2 - Planner Service:**
```powershell
.\.venv\Scripts\Activate.ps1
cd services/planner
uvicorn main:app --reload --port 8002
```

**Terminal 3 - Quiz Service:**
```powershell
.\.venv\Scripts\Activate.ps1
cd services/quiz
uvicorn main:app --reload --port 8003
```

**Terminal 4 - Gateway:**
```powershell
cd gateway
go run main.go
```

**Terminal 5 - Frontend:**
```powershell
cd frontend
npm install  # First time only
npm run dev
```

---

## üß™ Testing Commands

### Health Checks

```powershell
# Gateway
curl http://localhost:8080/health

# RAG Service
curl http://localhost:8001/health

# Planner Service
curl http://localhost:8002/health

# Quiz Service
curl http://localhost:8003/health

# Check all services at once
@('8080', '8001', '8002', '8003') | ForEach-Object { 
    Write-Host "Checking port $_..." 
    curl "http://localhost:$_/health" 
}
```

### API Testing

**Search Resources:**
```powershell
curl -X POST http://localhost:8001/search `
  -H "Content-Type: application/json" `
  -d '{
    "query": "learn event-driven architecture",
    "top_k": 10,
    "rerank": true,
    "rerank_top_n": 5
  }'
```

**Generate Learning Plan:**
```powershell
curl -X POST http://localhost:8002/plan `
  -H "Content-Type: application/json" `
  -d '{
    "goal": "Learn Event-Driven Architecture",
    "current_skills": [],
    "time_budget_hours": 40,
    "hours_per_week": 10
  }'
```

**Get Existing Plan:**
```powershell
# Replace {plan_id} with actual UUID
curl http://localhost:8002/plan/{plan_id}
```

**Generate Quiz:**
```powershell
# Replace with actual resource UUIDs
curl -X POST http://localhost:8003/generate `
  -H "Content-Type: application/json" `
  -d '{
    "resource_ids": ["uuid1", "uuid2"],
    "num_questions": 5,
    "difficulty": "medium"
  }'
```

---

## üîç Debugging Commands

### View Logs

```powershell
# All services
docker-compose logs -f

# Specific service
docker-compose logs -f rag-service
docker-compose logs -f planner-service
docker-compose logs -f quiz-service
docker-compose logs -f gateway
docker-compose logs -f postgres
docker-compose logs -f qdrant

# Last 100 lines
docker-compose logs --tail=100 rag-service

# Since specific time
docker-compose logs --since 30m rag-service
```

### Check Service Status

```powershell
# Docker containers
docker-compose ps

# Port usage
netstat -ano | findstr "8080 8001 8002 8003 5432 6333"

# Process list
Get-Process | Where-Object {$_.ProcessName -like "*python*" -or $_.ProcessName -like "*go*"}
```

### Restart Services

```powershell
# Restart specific service
docker-compose restart rag-service

# Restart all services
docker-compose restart

# Stop and start (full restart)
docker-compose down
docker-compose up -d
```

---

## üèóÔ∏è Build Commands

### Build Docker Images

```powershell
# Build all images
docker-compose build

# Build specific service
docker-compose build rag-service

# Build without cache (clean build)
docker-compose build --no-cache rag-service

# Build and start
docker-compose up -d --build
```

### Frontend Build

```powershell
cd frontend

# Development build
npm run dev

# Production build
npm run build

# Start production server
npm run start

# Lint code
npm run lint
```

### Gateway Build

```powershell
cd gateway

# Build binary
go build -o gateway.exe main.go

# Run binary
.\gateway.exe

# Build for Linux (cross-compile)
$env:GOOS="linux"; $env:GOARCH="amd64"; go build -o gateway main.go
```

---

## üì¶ Dependency Management

### Python Dependencies

```powershell
# Activate virtual environment
.\.venv\Scripts\Activate.ps1

# Update pip
pip install --upgrade pip

# Install/update dependencies
pip install -r services/rag/requirements.txt
pip install -r services/planner/requirements.txt
pip install -r services/quiz/requirements.txt

# Freeze current dependencies
pip freeze > requirements-freeze.txt

# Check for outdated packages
pip list --outdated
```

### Go Dependencies

```powershell
cd gateway

# Download dependencies
go mod download

# Tidy dependencies
go mod tidy

# Update dependencies
go get -u ./...

# Verify dependencies
go mod verify
```

### Frontend Dependencies

```powershell
cd frontend

# Install dependencies
npm install

# Update dependencies
npm update

# Check for outdated packages
npm outdated

# Audit for vulnerabilities
npm audit

# Fix vulnerabilities
npm audit fix
```

---

## üßπ Cleanup Commands

### Clean Docker

```powershell
# Remove stopped containers
docker-compose down

# Remove volumes (WARNING: deletes data)
docker-compose down -v

# Remove all unused Docker resources
docker system prune -a

# Remove specific image
docker rmi learnpath-rag-service
```

### Clean Python

```powershell
# Remove virtual environment
Remove-Item -Recurse -Force .venv

# Remove Python cache files
Get-ChildItem -Recurse -Filter "__pycache__" | Remove-Item -Recurse -Force
Get-ChildItem -Recurse -Filter "*.pyc" | Remove-Item -Force
```

### Clean Frontend

```powershell
cd frontend

# Remove node_modules
Remove-Item -Recurse -Force node_modules

# Remove build artifacts
Remove-Item -Recurse -Force .next

# Clean install
npm ci
```

---

## üöÄ Deployment Commands

### Railway Deployment (Backend)

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Link project
railway link

# Deploy specific service
railway up --service rag-service

# View logs
railway logs --service rag-service

# Set environment variables
railway variables set OPENROUTER_API_KEY=your_key
```

### Vercel Deployment (Frontend)

```bash
# Install Vercel CLI
npm install -g vercel

# Login
vercel login

# Deploy to preview
vercel

# Deploy to production
vercel --prod

# Set environment variables
vercel env add NEXT_PUBLIC_API_URL
```

---

## üìä Monitoring Commands

### Check Resource Usage

```powershell
# Docker stats
docker stats

# Container resource usage
docker stats learnpath-rag-service

# Disk usage
docker system df
```

### Performance Testing

```powershell
# Simple load test (requires Apache Bench)
ab -n 100 -c 10 http://localhost:8001/health

# Measure response time
Measure-Command { curl http://localhost:8001/health }
```

---

## üîê Security Commands

### Generate Secrets

```powershell
# Generate random secret (32 bytes)
[Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Maximum 256 }))

# Generate UUID
[guid]::NewGuid().ToString()
```

### Check for Vulnerabilities

```powershell
# Python
pip install safety
safety check

# Frontend
cd frontend
npm audit

# Go
cd gateway
go list -json -m all | nancy sleuth
```

---

## üìù Useful Queries

### Database Queries

```sql
-- Count resources by level
SELECT level, COUNT(*) FROM resources GROUP BY level;

-- Count resources by media type
SELECT media_type, COUNT(*) FROM resources GROUP BY media_type;

-- Recent learning plans
SELECT plan_id, goal, total_hours, estimated_weeks, created_at 
FROM learning_plans 
ORDER BY created_at DESC 
LIMIT 10;

-- Skills with most resources
SELECT s.name, COUNT(r.id) as resource_count
FROM skill s
LEFT JOIN resource r ON s.id = ANY(r.skills)
GROUP BY s.id, s.name
ORDER BY resource_count DESC;

-- Resources without embeddings (need to be ingested)
SELECT r.id, r.title 
FROM resource r 
WHERE NOT EXISTS (
  SELECT 1 FROM qdrant_collection WHERE resource_id = r.id
);
```

---

## üéì Learning Resources

### Documentation Files
- `README.md` - Project overview
- `QUICKSTART.md` - Quick start guide
- `IMPLEMENTATION_STATUS.md` - Detailed status
- `DOCKER_SETUP.md` - Docker configuration
- `services/rag/QUANTIZATION.md` - Performance optimization
- `services/*/README.md` - Service-specific docs

### API Documentation
- RAG Service: http://localhost:8001/docs
- Planner Service: http://localhost:8002/docs
- Quiz Service: http://localhost:8003/docs

---

## üêõ Common Issues & Solutions

### Issue: Port Already in Use
```powershell
# Find process using port
netstat -ano | findstr "8001"

# Kill process (replace PID)
taskkill /PID <PID> /F
```

### Issue: Database Connection Failed
```powershell
# Check if PostgreSQL is running
docker-compose ps postgres

# Restart PostgreSQL
docker-compose restart postgres

# Check logs
docker-compose logs postgres
```

### Issue: Qdrant Connection Failed
```powershell
# Check if Qdrant is running
docker-compose ps qdrant

# Restart Qdrant
docker-compose restart qdrant

# Access Qdrant dashboard
start http://localhost:6333/dashboard
```

### Issue: Python Module Not Found
```powershell
# Ensure virtual environment is activated
.\.venv\Scripts\Activate.ps1

# Reinstall dependencies
pip install -r services/rag/requirements.txt
```

### Issue: Go Build Fails
```powershell
cd gateway

# Clean and rebuild
go clean
go mod tidy
go build main.go
```

### Issue: Frontend Won't Start
```powershell
cd frontend

# Clear cache and reinstall
Remove-Item -Recurse -Force node_modules
Remove-Item -Recurse -Force .next
npm install
npm run dev
```

---

## üìÖ Session Summary (2025-11-09)

### What We Discussed
1. **Course Planning Mechanism:**
   - Explained how RAG service finds resources (semantic search + reranking)
   - Detailed how LLM orders resources (difficulty, prerequisites, time budget)
   - Identified that only metadata (title + description) is used, not actual content

2. **Content Usage Analysis:**
   - Confirmed RAG only uses title + description for embeddings
   - Quiz service does use actual content from S3
   - Infrastructure exists for content-based RAG but not implemented

### Key Findings
- ‚úÖ System is 98% complete
- ‚ö†Ô∏è Content extraction pipeline not implemented
- ‚ö†Ô∏è Prerequisite graph exists but unused
- ‚ö†Ô∏è Need to seed database with quality resources

### Files Created This Session
- `planning/design_2025-11-09_00h35.md` - Comprehensive design document
- `planning/plan_2025-11-09_00h35.md` - This implementation plan

---

## üéØ Immediate Action Items

1. **Seed Database** (1-2 hours)
   ```powershell
   python -m ingestion.seed_skills
   python -m ingestion.setup_qdrant
   python -m ingestion.ingest --seed ingestion/seed_resources.json --limit 100
   ```

2. **Test End-to-End Flow** (30 minutes)
   - Create a learning plan via frontend
   - Verify resources are relevant
   - Test quiz generation

3. **Configure Authentication** (2-3 hours)
   - Set up Supabase project
   - Add auth to frontend
   - Protect service endpoints

4. **Deploy to Staging** (2-3 hours)
   - Deploy to Railway/Vercel
   - Test in production-like environment
   - Gather feedback

---

**Document Version:** 1.0  
**Last Updated:** 2025-11-09 00:35  
**Next Session:** Focus on data seeding and deployment
